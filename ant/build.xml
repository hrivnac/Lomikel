<project name="Lomikel"
         default="compile"
         basedir="../run">

  <description>
    Lomikel
    </description>

  <!-- Setup ================================================================-->

  <property environment="env"/>
  <property file="../ant/build-global.properties"/>
  <property file="../ant/build-local.properties"/>
  <property file="../ant/target-${target}.properties"/>
  <property name="site" value="${env.site}"/>

  <echo>Building for site ${target} on ${site}</echo>

  <path id="classpath.build">
    <pathelement path="${log4j_jar}"/>
    <pathelement path="${httpclient_jar}"/>
    <pathelement path="${httpcore_jar}"/>
    <pathelement path="${logging_jar}"/>
    <pathelement path="${cli_jar}"/>
    <pathelement path="${orgjson_jar}"/>
    <pathelement path="${slf4j_jar}"/>
    <pathelement path="${hbasecommon_jar}"/>
    <pathelement path="${hbaseclient_jar}"/>
    <pathelement path="${hadoopcommon_jar}"/>
    <pathelement path="${javaxmail_jar}"/>
    <pathelement path="${javaxservlet_jar}"/>
    <pathelement path="${healpix_jar}"/>
    <pathelement path="${bsh_jar}"/>
    <pathelement path="${parquetavro_jar}"/>    
    <pathelement path="${parquethadoop_jar}"/>    
    <pathelement path="${jacksoncore_jar}"/>    
    <pathelement path="${jacksonmapper_jar}"/>    
    <pathelement path="${jython_jar}"/>    
    <pathelement path="${cli_jar}"/>
    <fileset dir="${janusgraph_dir}/lib">
      <include name="*.jar"/>
      </fileset>
    <fileset dir="../extlib">
      <include name="*.jar"/>
      </fileset>
    </path>

  <path id="classpath.run">
    <fileset dir="../lib">
      <include name="*.jar"/>
      <exclude name="*.exe.jar"/>
      </fileset>
    <fileset dir="${hadoop_dir}">
      <include name="share/hadoop/client/*.jar"/>
      </fileset>
    <fileset dir="${hadoop_dir}">
      <include name="share/hadoop/common/*.jar"/>
      </fileset>
     <fileset dir="${hbase_dir}">
      <include name="lib/*.jar"/>
      </fileset>
    <pathelement path="${phoenix_jar}"/>
    <path refid="classpath.build"/>
    </path>
    
  <path id="classpath_phoenix.run">
    <pathelement path="${groovy_jar}"/>
    <pathelement path="${groovy_sql_jar}"/>
    <pathelement path="${hadoop_phoenix_conf}"/>
    <pathelement path="${hbase_phoenix_conf}"/>
    <pathelement path="${phoenix_jar}"/>
    <!--path refid="classpath.build"/-->
    </path>

  <path id="classpath.groovy">
    <fileset dir="${groovy_dir}/lib" includes="*.jar" excludes="groovy-ant-*.jar"/>
    <fileset dir="${phoenix_dir}"    includes="${phoenix_jar_name}"/>
    </path>    
    
  <path id="classpath.janusgraph">
    <fileset dir="${janusgraph_dir}/lib">
      <include name="*.jar"/>
      <exclude name="logback-classic-1.1.3.jar"/>
      </fileset>
    <fileset dir="../lib">
      <include name="*.jar"/>
      <exclude name="*.exe.jar"/>
      </fileset>
    <fileset dir="../extlib">
      <include name="*.jar"/>
      </fileset>
    <pathelement path="${bsh_jar}"/>
    </path>

  <property name="classpath.build.content"       refid="classpath.build"/>
  <property name="classpath.run.content"         refid="classpath.run"/>
  <property name="classpath_phoenix.run.content" refid="classpath_phoenix.run"/>

  <taskdef name="groovy"
           classname="org.codehaus.groovy.ant.Groovy">    <!--fileset dir="../lib">
      <include name="*.jar"/>
      <exclude name="*.exe.jar"/>
      </fileset-->

    <classpath>
      <fileset file="${groovy_jar}"/>
      <fileset file="${groovy_ant_jar}"/>
      </classpath>
    </taskdef>

  <taskdef name="groovyc"
           classname="org.codehaus.groovy.ant.Groovyc">
    <classpath>
      <fileset file="${groovy_jar}"/>
      <fileset file="${groovy_ant_jar}"/>
      </classpath>
    </taskdef>

  <taskdef resource="edu/umd/cs/findbugs/anttask/tasks.properties"
           classpath="${spotbugs}/lib/spotbugs-ant.jar" />

  <!-- Info =================================================================-->
    
  <target name="info"
          depends="init"
          description="Create Info class">
    <mkdir dir="../build/com/Lomikel/Utils"/>
    <copy file="../src/java/com/Lomikel/Utils/Info.pre"
          tofile="../build/com/Lomikel/Utils/Info.java"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@version@"     value="${version}"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@TSTAMP@"      value="${TSTAMP}"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@user.name@"   value="${user.name}"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@TMP@"         value="${tmp_dir}"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@MANAGER@"     value="${manager}"/>
    <replace file="../build/com/Lomikel/Utils/Info.java" token="@TARGET@"      value="${target}"/>
    </target>

  <!-- Init =================================================================-->

  <target name="init"
          description="Initialise environment">
    <tstamp>
      <format property="TSTAMP" pattern="dd/MMM/yyyy 'at' kk:mm:ss z"/>
      </tstamp>
    <mkdir dir="../build"/>
    <mkdir dir="../lib"/>
    <mkdir dir="../extlib"/>
    <mkdir dir="../extlib/import"/>
    <mkdir dir="../run"/>
    <mkdir dir="../dist"/>
    <mkdir dir="../doc/JavaDoc"/>
    <copy todir="../extlib/import">
			<fileset file="${log4j_jar}"/>
			<fileset file="${slf4j_jar}"/>
			<fileset file="${slf4jlog4j_jar}"/>
			<fileset file="${bsh_jar}"/>
			<fileset file="${scala_jar}"/>
			<fileset file="${httpclient_jar}"/>
			<fileset file="${httpcore_jar}"/>
			<fileset file="${logging_jar}"/>
			<fileset file="${cli_jar}"/>
			<fileset file="${orgjson_jar}"/>
			<fileset file="${javaxmail_jar}"/>
			<fileset file="${javaxservlet_jar}"/>
			<fileset file="${math3_jar}"/>
			<fileset file="${healpix_jar}"/>
			<fileset file="${groovy_jar}"/>
			<fileset file="${groovysh_jar}"/>
			<fileset file="${groovy_ant_jar}"/>
			<fileset file="${groovy_sql_jar}"/>
			<fileset file="${hbasecommon_jar}"/>
			<fileset file="${hbaseclient_jar}"/>
			<fileset file="${hadoopcommon_jar}"/>
			<fileset file="${parquetavro_jar}"/>
			<fileset file="${parquethadoop_jar}"/>
			<fileset file="${jython_jar}"/>
			<!--fileset file="${phoenix_jar}"/-->
      </copy>
    </target>
    
  <target name="classpath.hadoop"
          description="Prepare Hadoop Classpath">   
    <exec executable="../src/sh/hadoopclasspath.sh"
          outputproperty="classpath.hadoop">
      <arg value="classpath"/>
      </exec>
    <script language="javascript">
      var before = project.getProperty("classpath.hadoop");
      project.setProperty("classes.hadoop", before.replaceAll(":", ","));
      </script>
    </target>

  <!-- Compile ==============================================================-->

  <target name="compile"
          depends="init,info"
          description="Compile sources">
    <echo message="Using Java version ${ant.java.version}(${java.version})."/>
    <javac destdir="../build"
           fork="yes"
           debug="yes"
           debuglevel="lines,vars,source"
           optimize="yes"
           source="8"
           target="8">
      <src path="../src/java"/>
      <src path="../build"/>
      <!--exclude name="com/Lomikel/TinkerPopPatch/**"/-->
      <classpath>
        <path refid="classpath.build"/>
        </classpath>
      </javac>
    </target>
        
  <!-- Compile Native =======================================================-->
    
  <target name="compile-native"
          depends="jar"
          description="Compile into native application">
    <exec executable="${graalvm_dir}/bin/native-image">
      <arg value="--initialize-at-build-time=org.apache.log4j.Level,org.apache.log4j.Logger,org.apache.log4j.helpers.LogLog,org.apache.log4j.Priority,org.apache.log4j.LogManager,org.apache.log4j.helpers.Loader,org.apache.log4j.Category,org.apache.log4j.spi.RootLogger,org.apache.log4j.spi.LoggingEvent,org.slf4j.LoggerFactory,org.slf4j.impl.Log4jLoggerAdapter,org.slf4j.impl.Log4jLoggerFactory,org.slf4j.impl.StaticLoggerBinder"/>
      <arg value="-H:Name=Lomikel.exe"/>
      <arg value="-H:Path=../bin"/>
      <arg value="-jar"/>
      <arg value="../lib/Lomikel.exe.jar"/>
      </exec>
    </target>
    
  <!-- Create JAR ===========================================================-->
  
  <target name="jar"
          depends="compile"
          description="Create JAR">
    <path id="libs">
      <fileset dir="../extlib">
        <include name="*.jar"/>
        <exclude name="*.exe.jar"/>
        </fileset>
      </path>
    <property name="classpath.libs" refid="libs"/>
    <jar jarfile="../lib/Lomikel-${version}.jar" index="yes">
      <fileset dir="../build"      includes="**/*.class"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.properties"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.bsh"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.txt"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.png"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.gif"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.css"/>
      <fileset dir="../src/java"   includes="com/Lomikel/**/*.groovy"/>
      <fileset dir="../build"      includes="com/astrolabsoftware/FinkBrowser/**/*.class"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.properties"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.bsh"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.txt"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.png"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.gif"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.css"/>
      <fileset dir="../src/java"   includes="com/astrolabsoftware/FinkBrowser/**/*.groovy"/>
      <fileset dir="../src/bsh"    includes="*.bsh"/>
      <fileset dir="../src/groovy" includes="*.groovy"/>
      <zipfileset includes="**/*" src="${log4j_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${slf4j_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${slf4jlog4j_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${logging_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${bsh_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${cli_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${healpix_jar}" excludes="META-INF/*"/>
      <service type="org.apache.tinkerpop.gremlin.jsr223.GremlinPlugin">
        <provider classname="com.Lomikel.GremlinPlugin.LomikelConnector"/>
        </service>
     <manifest>
        <attribute name="Created-By" value="${user.name}"/>
        <attribute name="AppName"    value="Lomikel"/>
        <attribute name="AppVersion" value="${version} ${TSTAMP}"/>
        </manifest>
      </jar>
    <jar jarfile="../lib/Lomikel-full-${version}.jar" index="yes">
      <zipfileset includes="**/*" src="../lib/Lomikel-${version}.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${orgjson_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${javaxmail_jar}" excludes="META-INF/*"/>
      <!--zipfileset includes="**/*" src="${hadoopcommon_jar}" excludes="META-INF/*"/-->
      <zipfileset includes="**/*" src="${hbasecommon_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbaseclient_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${groovysh_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${parquethadoop_jar}" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${jython_jar}" excludes="META-INF/*"/>
      
      <!--zipfileset includes="**/*" src="${hbase_dir}/lib/commons-beanutils-core-1.8.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-cli-1.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-codec-1.10.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-collections-3.2.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-configuration-1.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-compress-1.4.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-crypto-1.0.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-daemon-1.0.13.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-digester-1.8.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-io-2.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-lang-2.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-lang3-3.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-math-2.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-math3-3.6.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/commons-net-3.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/gson-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/guice-3.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/guice-servlet-3.0.jar" excludes="META-INF/*"/-->
      
      <!--zipfileset includes="**/*" src="${hbase_dir}/lib/hadoop-annotations-2.8.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hadoop-auth-2.8.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hadoop-client-2.8.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hadoop-distcp-2.8.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hamcrest-core-1.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-annotations-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-endpoint-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-external-blockcache-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-hadoop2-compat-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-hadoop-compat-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-hbtop-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-http-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-it-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-procedure-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-protocol-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-protocol-shaded-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-resource-bundle-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-rest-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-rsgroup-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-shaded-miscellaneous-2.2.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-shaded-netty-2.2.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-shaded-protobuf-2.2.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hbase-zookeeper-2.2.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hk2-api-2.5.0-b32.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hk2-locator-2.5.0-b32.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/hk2-utils-2.5.0-b32.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/jamon-runtime-2.4.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/javassist-3.20.0-GA.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/javax.activation-1.2.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/javax.annotation-api-1.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/javax.el-3.0.1-b08.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/javax.inject-2.5.0-b32.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/java-xmlbuilder-0.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/jaxb-api-2.2.12.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/jaxb-impl-2.2.3-1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/jcip-annotations-1.0-1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/jcodings-1.0.18.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/joni-2.1.11.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/leveldbjni-all-1.8.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/libthrift-0.12.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/metrics-core-3.2.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/nimbus-jose-jwt-4.41.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/okhttp-2.4.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/okio-1.4.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/osgi-resource-locator-1.0.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/paranamer-2.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/protobuf-java-2.5.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/snappy-java-1.0.5.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/spymemcached-2.12.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/validation-api-1.1.0.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/xmlenc-0.52.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/xz-1.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/zookeeper-3.4.10.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${hbase_dir}/lib/client-facing-thirdparty/htrace-core4-4.2.0-incubating.jar" excludes="META-INF/*"/-->
      
      <!--zipfileset includes="**/*" src="${janusgraph_dir}/lib/caffeine-2.3.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-codec-1.15.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-collections-3.2.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-configuration-1.10.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-configuration2-2.7.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-lang-2.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-lang3-3.11.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-logging-1.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/commons-text-1.9.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/exp4j-0.4.8.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/guava-29.0-jre.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/gremlin-console-3.5.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/gremlin-core-3.5.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/gremlin-driver-3.5.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/gremlin-groovy-3.5.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/gremlin-shaded-3.5.3.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-2.5.14-indy.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-cli-picocli-2.5.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-console-2.5.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-json-2.5.14-indy.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-jsr223-2.5.14-indy.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-swing-2.5.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-templates-2.5.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/groovy-xml-2.5.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/hppc-0.8.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/httpclient-4.5.13.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/httpcore-4.4.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/ivy-2.4.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/janusgraph-driver-0.6.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/javapoet-1.8.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/javatuples-1.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jbcrypt-0.4.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jcabi-log-0.14.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jcabi-manifests-1.1.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jcl-over-slf4j-1.7.30.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jline-2.14.6.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/jts-core-1.17.0.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/log4j-1.2.17.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-all-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-buffer-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-codec-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-codec-http-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-common-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-handler-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-resolver-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/netty-transport-4.1.72.Final.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/picocli-4.3.2.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/slf4j-api-1.7.30.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/slf4j-log4j12-1.7.30.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/snakeyaml-1.28.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/spatial4j-0.8.jar" excludes="META-INF/*"/>
      <zipfileset includes="**/*" src="${janusgraph_dir}/lib/tinkergraph-gremlin-3.5.3.jar" excludes="META-INF/*"/-->
      <manifest>
        <attribute name="Created-By" value="${user.name}"/>
        <attribute name="AppName"    value="Lomikel"/>
        <attribute name="AppVersion" value="${version} ${TSTAMP}"/>
        </manifest>
      </jar>
    <jar jarfile="../lib/Lomikel.exe.jar" index="yes">
      <zipfileset includes="**/*" src="../lib/Lomikel-full-${version}.jar" excludes="META-INF/*"/>
      <manifest>
        <attribute name="Created-By" value="${user.name}"/>
        <attribute name="AppName"    value="Lomikel"/>
        <attribute name="AppVersion" value="${version} ${TSTAMP}"/>
        <attribute name="Main-Class" value="com.Lomikel.Apps.LUC"/>
        </manifest>
      <service type="java.sql.Driver">
        <provider classname="org.apache.phoenix.jdbc.PhoenixDriver"/>
        </service>
      </jar>
    </target>
    
  <!-- WAR ==================================================================-->

  <target name="war"
          depends="jar"
          description="Create WAR">
    <echo>Creating Lomikel.war</echo>
 		<copy file="../src/ws/index.jsp"             tofile="../build/index.jsp"   overwrite="true"/>
 		<copy file="../src/ws/Top.jsp"               tofile="../build/Top.jsp"     overwrite="true"/>
 		<copy file="../src/ws/TopMini.jsp"           tofile="../build/TopMini.jsp" overwrite="true"/>
 		<copy file="../src/ws/Servers-${target}.jsp" tofile="../build/Servers.jsp" overwrite="true"/>
 		<copy file="../src/ws/Graphs-${target}.jsp"  tofile="../build/Graphs.jsp"  overwrite="true"/>
    <replace file="../build/index.jsp"   token="@NAME@"    value="${browsername}"/>
    <replace file="../build/index.jsp"   token="@ICON@"    value="${browsericon}"/>
    <replace file="../build/Top.jsp"     token="@VERSION@" value="${version}"/>
    <replace file="../build/Top.jsp"     token="@BUILD@"   value="${TSTAMP} by ${user.name} for ${target}"/>
    <replace file="../build/Top.jsp"     token="@NAME@"    value="${browsername}"/>
    <replace file="../build/Top.jsp"     token="@LOGO@"    value="${browserlogo}"/>
    <replace file="../build/Top.jsp"     token="@HOME@"    value="${browserurl}"/>
    <replace file="../build/Top.jsp"     token="@BOOT@"    value="${bootgremlin}"/>
    <replace file="../build/TopMini.jsp" token="@VERSION@" value="${version}"/>
    <replace file="../build/TopMini.jsp" token="@BUILD@"   value="${TSTAMP} by ${user.name} for ${target}"/>
    <replace file="../build/TopMini.jsp" token="@NAME@"    value="${browsername}"/>
    <replace file="../build/TopMini.jsp" token="@LOGO@"    value="${browserlogo}"/>
    <replace file="../build/TopMini.jsp" token="@HOME@"    value="${browserurl}"/>
    <replace file="../build/TopMini.jsp" token="@BOOT@"    value="${bootgremlin}"/>
    <war destfile="../lib/Lomikel.war" webxml="../src/ws/web.xml">
      <fileset dir="../src/ws">
	    	<include name="**/*"/>
        </fileset>
      <fileset dir="../extlib/ws">
	    	<include name="**/*"/>
	    	<exclude name="js9-3.0-src/**/*"/>
	    	<exclude name="vis-network-8.3.2-src/**/*"/>
	    	<exclude name="vis-timeline-7.3.9-src/**/*"/>
        </fileset>
      <fileset dir="../build">
        <include name="index.jsp"/>
        <include name="Top.jsp"/>
        <include name="TopMini.jsp"/>
        <include name="Graphs.jsp"/>
        <include name="Servers.jsp"/>
        </fileset>
      <classes dir="../src/ws">
        <include name="log4j.properties"/>
        </classes>
      <lib file="../lib/Lomikel-${version}.jar"/>
      <lib file="${orgjson_jar}"/>
      <lib file="${javaxmail_jar}"/>
      <lib file="${javaxservlet_jar}"/>
      <lib file="${hbasecommon_jar}"/>
      <lib file="${hbaseclient_ja}"/>
      <lib file="${hadoopcommon_jar}"/>
      <lib file="${groovysh_jar}"/>
      <lib file="${healpix_jar}"/>
      <lib file="${janusgraph_dir}/lib/caffeine-2.3.1.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-codec-1.14.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-collections-3.2.2.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-configuration-1.10.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-lang-2.5.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-lang3-3.3.1.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-logging-1.1.1.jar"/>
      <lib file="${janusgraph_dir}/lib/exp4j-0.4.8.jar"/>
      <lib file="${janusgraph_dir}/lib/guava-18.0.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-console-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-core-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-driver-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-groovy-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-shaded-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-cli-picocli-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-console-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-json-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-jsr223-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-swing-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-templates-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-xml-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/hppc-0.7.1.jar"/>
      <lib file="${janusgraph_dir}/lib/httpclient-4.5.10.jar"/>
      <lib file="${janusgraph_dir}/lib/httpcore-4.4.12.jar"/>
      <lib file="${janusgraph_dir}/lib/ivy-2.3.0.jar"/>
      <lib file="${janusgraph_dir}/lib/janusgraph-driver-0.5.3.jar"/>
      <lib file="${janusgraph_dir}/lib/javapoet-1.8.0.jar"/>
      <lib file="${janusgraph_dir}/lib/javatuples-1.2.jar"/>
      <lib file="${janusgraph_dir}/lib/jbcrypt-0.4.jar"/>
      <lib file="${janusgraph_dir}/lib/jcabi-log-0.14.jar"/>
      <lib file="${janusgraph_dir}/lib/jcabi-manifests-1.1.jar"/>
      <lib file="${janusgraph_dir}/lib/jcl-over-slf4j-1.7.25.jar"/>
      <lib file="${janusgraph_dir}/lib/jline-2.14.6.jar"/>
      <lib file="${janusgraph_dir}/lib/log4j-1.2.16.jar"/>
      <lib file="${janusgraph_dir}/lib/netty-all-4.1.72.Final.jar"/>
      <lib file="${janusgraph_dir}/lib/picocli-3.9.5.jar"/>
      <lib file="${janusgraph_dir}/lib/slf4j-api-1.7.12.jar"/>
      <lib file="${janusgraph_dir}/lib/slf4j-log4j12-1.7.12.jar"/>
      <lib file="${janusgraph_dir}/lib/snakeyaml-1.11.jar"/>
      <lib file="${janusgraph_dir}/lib/spatial4j-0.7.jar"/>
      <lib file="${janusgraph_dir}/lib/tinkergraph-gremlin-3.4.6.jar"/>
      <manifest>
        <attribute name="Created-By" value="${user.name}"/>
        <attribute name="AppName"    value="Lomikel"/>
        <attribute name="AppVersion" value="${version} ${TSTAMP}"/>
        </manifest>
      </war>
    <echo>Creating FinkBrowser.war</echo>
 		<copy file="../src/ws/index.jsp"                         tofile="../build/index.jsp"   overwrite="true"/>
 		<copy file="../src/ws/Top.jsp"                           tofile="../build/Top.jsp"     overwrite="true"/>
 		<copy file="../src/ws/TopMini.jsp"                       tofile="../build/TopMini.jsp" overwrite="true"/>
 		<copy file="../src/ws/FinkBrowser/Servers-${target}.jsp" tofile="../build/Servers.jsp" overwrite="true"/>
 		<copy file="../src/ws/FinkBrowser/Graphs-${target}.jsp"  tofile="../build/Graphs.jsp"  overwrite="true"/>
    <replace file="../build/index.jsp"   token="@NAME@"    value="${browsername}"/>
    <replace file="../build/index.jsp"   token="@ICON@"    value="${browsericon}"/>
    <replace file="../build/Top.jsp"     token="@VERSION@" value="${version}"/>
    <replace file="../build/Top.jsp"     token="@BUILD@"   value="${TSTAMP} by ${user.name} for ${target}"/>
    <replace file="../build/Top.jsp"     token="@NAME@"    value="${browsername}"/>
    <replace file="../build/Top.jsp"     token="@LOGO@"    value="${browserlogo}"/>
    <replace file="../build/Top.jsp"     token="@HOME@"    value="${browserurl}"/>
    <replace file="../build/Top.jsp"     token="@BOOT@"    value="${bootgremlin}"/>
    <replace file="../build/TopMini.jsp" token="@VERSION@" value="${version}"/>
    <replace file="../build/TopMini.jsp" token="@BUILD@"   value="${TSTAMP} by ${user.name} for ${target}"/>
    <replace file="../build/TopMini.jsp" token="@NAME@"    value="${browsername}"/>
    <replace file="../build/TopMini.jsp" token="@LOGO@"    value="${browserlogo}"/>
    <replace file="../build/TopMini.jsp" token="@HOME@"    value="${browserurl}"/>
    <replace file="../build/TopMini.jsp" token="@BOOT@"    value="${bootgremlin}"/>
    <war destfile="../lib/FinkBrowser.war" webxml="../src/ws/web.xml">
      <fileset dir="../src/ws/FinkBrowser">
        <include name="**/*"/>
        </fileset>
      <fileset dir="../src/ws">
        <include name="**/*"/>
        <exclude name="Stylesheet.js"/>
        <exclude name="Options.js"/>
        <exclude name="Init.jsp"/>
        <exclude name="Servers*.jsp"/>
        <exclude name="Graphs*.jsp"/>
        <exclude name="Result.jsp"/>
        <exclude name="Plot.jsp"/>
        <exclude name="SkyView.jsp"/>
        <exclude name="Params.jsp"/>
        <exclude name="PropertiesProcessor.jsp"/>
        <exclude name="Image.jsp"/>
        <exclude name="HBaseClient.jsp"/>
        <exclude name="profiles/*"/>
        <exclude name="styles/*"/>
        <exclude name="d3/actions.js"/>
        </fileset>
      <fileset dir="../extlib/ws">
	    	<include name="**/*"/>
	    	<exclude name="js9-3.0-src/**/*"/>
	    	<exclude name="vis-network-8.3.2-src/**/*"/>
	    	<exclude name="vis-timeline-7.3.9-src/**/*"/>
        </fileset>
      <fileset dir="../build">
        <include name="index.jsp"/>
        <include name="Top.jsp"/>
        <include name="TopMini.jsp"/>
        <include name="Graphs.jsp"/>
        <include name="Servers.jsp"/>
        </fileset>
      <classes dir="../src/ws/FinkBrowser">
        <include name="log4j.properties"/>
        </classes>
      <lib file="../lib/Lomikel-${version}.jar"/>
       <lib file="${orgjson_jar}"/>
      <lib file="${javaxmail_jar}"/>
      <lib file="${javaxservlet_jar}"/>
      <lib file="${hbasecommon_jar}"/>
      <lib file="${hbaseclient_ja}"/>
      <lib file="${hadoopcommon_jar}"/>
      <lib file="${groovysh_jar}"/>
      <lib file="${healpix_jar}"/>
      <lib file="${janusgraph_dir}/lib/caffeine-2.3.1.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-codec-1.14.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-collections-3.2.2.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-configuration-1.10.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-lang-2.5.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-lang3-3.3.1.jar"/>
      <lib file="${janusgraph_dir}/lib/commons-logging-1.1.1.jar"/>
      <lib file="${janusgraph_dir}/lib/exp4j-0.4.8.jar"/>
      <lib file="${janusgraph_dir}/lib/guava-18.0.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-console-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-core-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-driver-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-groovy-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/gremlin-shaded-3.4.6.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-cli-picocli-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-console-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-json-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-jsr223-2.5.7-indy.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-swing-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-templates-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/groovy-xml-2.5.7.jar"/>
      <lib file="${janusgraph_dir}/lib/hppc-0.7.1.jar"/>
      <lib file="${janusgraph_dir}/lib/httpclient-4.5.10.jar"/>
      <lib file="${janusgraph_dir}/lib/httpcore-4.4.12.jar"/>
      <lib file="${janusgraph_dir}/lib/ivy-2.3.0.jar"/>
      <lib file="${janusgraph_dir}/lib/janusgraph-driver-0.5.3.jar"/>
      <lib file="${janusgraph_dir}/lib/javapoet-1.8.0.jar"/>
      <lib file="${janusgraph_dir}/lib/javatuples-1.2.jar"/>
      <lib file="${janusgraph_dir}/lib/jbcrypt-0.4.jar"/>
      <lib file="${janusgraph_dir}/lib/jcabi-log-0.14.jar"/>
      <lib file="${janusgraph_dir}/lib/jcabi-manifests-1.1.jar"/>
      <lib file="${janusgraph_dir}/lib/jcl-over-slf4j-1.7.25.jar"/>
      <lib file="${janusgraph_dir}/lib/jline-2.14.6.jar"/>
      <lib file="${janusgraph_dir}/lib/log4j-1.2.16.jar"/>
      <lib file="${janusgraph_dir}/lib/netty-all-4.1.72.Final.jar"/>
      <lib file="${janusgraph_dir}/lib/picocli-3.9.5.jar"/>
      <lib file="${janusgraph_dir}/lib/slf4j-api-1.7.12.jar"/>
      <lib file="${janusgraph_dir}/lib/slf4j-log4j12-1.7.12.jar"/>
      <lib file="${janusgraph_dir}/lib/snakeyaml-1.11.jar"/>
      <lib file="${janusgraph_dir}/lib/spatial4j-0.7.jar"/>
      <lib file="${janusgraph_dir}/lib/tinkergraph-gremlin-3.4.6.jar"/>
      <manifest>
        <attribute name="Created-By" value="${user.name}"/>
        <attribute name="AppName"    value="FinkBrowser"/>
        <attribute name="AppVersion" value="${version} ${TSTAMP}"/>
        </manifest>
      </war>
    </target>
 
  <!-- Deploy WS ============================================================-->
    
  <target name="deploy"
          depends="war"
          description="Deploy Development WS">
    <antcall target="deploy-pure"/>
    <antcall target="deploy-sudo"/>
    <antcall target="deploy-ssh"/>
    </target>
    
  <target name="deploy-sudo"
          if="${sudo}">
    <exec executable="/usr/bin/sudo">
      <arg line="chmod 777 ${server_dir}"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="/bin/rm -f ${server_dir}/${user.name}-Lomikel.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="/bin/rm -f ${server_dir}/${user.name}-FinkBrowser.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="cp ../lib/Lomikel.war ${server_dir}/${user.name}-Lomikel.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="cp ../lib/FinkBrowser.war ${server_dir}/${user.name}-FinkBrowser.war"/>
      </exec>
    </target>
    
  <target name="deploy-ssh"
          if="${ssh}">
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} 'chmod 777 ${server_dir}'"/>
      </exec>
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} '/bin/rm -f ${server_dir}/${user.name}-Lomikel.war'"/>
      </exec>
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} '/bin/rm -f ${server_dir}/${user.name}-FinkBrowser.war'"/>
      </exec>
    <copy file="../lib/Lomikel.war"
          tofile="${server_dir}/${user.name}-Lomikel.war"/>
    <copy file="../lib/FinkBrowser.war"
          tofile="${server_dir}/${user.name}-FinkBrowser.war"/>
    </target>
    
  <target name="deploy-pure"
           if="${cp}">
    <copy file="../lib/Lomikel.war"
          tofile="${server_dir}/${user.name}-Lomikel.war"/>
    <copy file="../lib/FinkBrowser.war"
          tofile="${server_dir}/${user.name}-FinkBrowser.war"/>
    </target>
  
  <target name="deploy-prod"
          depends="war"
          description="Deploy Production WS">
    <antcall target="deploy-prod-pure"/>
    <antcall target="deploy-prod-sudo"/>
    <antcall target="deploy-prod-ssh"/>
    </target>
    
  <target name="deploy-prod-sudo"
          if="${sudo}">
    <exec executable="/usr/bin/sudo">
      <arg line="chmod 777 ${server_dir}"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="/bin/rm -f ${server_dir}/Lomikel.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="/bin/rm -f ${server_dir}/FinkBrowser.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="cp ../lib/Lomikel.war ${server_dir}/Lomikel.war"/>
      </exec>
    <exec executable="/usr/bin/sudo">
      <arg line="cp ../lib/FinkBrowser.war ${server_dir}/FinkBrowser.war"/>
      </exec>
    </target>
    
  <target name="deploy-prod-ssh"
          if="${ssh}">
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} 'chmod 777 ${server_dir}'"/>
      </exec>
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} '/bin/rm -f ${server_dir}/Lomikel.war'"/>
      </exec>
    <exec executable="/usr/bin/ssh">
      <arg line="root@${hostname} '/bin/rm -f ${server_dir}/FinkBrowser.war'"/>
      </exec>
    <copy file="../lib/Lomikel.war"
          tofile="${server_dir}/Lomikel.war"/>
    <copy file="../lib/FinkBrowser.war"
          tofile="${server_dir}/FinkBrowser.war"/>
    </target>
    
  <target name="deploy-prod-pure"
          if="${cp}">
    <copy file="../lib/Lomikel.war"
          tofile="${server_dir}/Lomikel.war"/>
    <copy file="../lib/FinkBrowser.war"
          tofile="${server_dir}/FinkBrowser.war"/>
    </target>
 
  <!-- Patch and Restart JanuGraph ==========================================-->
  
  <target name="janus-restart"
          description="Patch and Restart JanuGraph">
    <antcall target="janus-stop"/>
    <antcall target="janus-patch"/>
    <antcall target="janus-start-cors"/>
    </target>
 
  <!-- Patch JanusGraph =====================================================-->
  
  <target name="janus-patch"
          description="Patch JanusGraph">
    <echo>Patching JanusGraph Server</echo>
    <echo>... system</echo>
 		<copy todir="${janusgraph_dir}/scripts" overwrite="true">
			<fileset dir="../src/gremlin" includes="functions.gremlin"/>
			<fileset dir="../src/sys/janusgraph/scripts" includes="*"/>
      </copy>
 		<copy todir="${janusgraph_dir}/conf" overwrite="true">
			<fileset dir="../src/sys/janusgraph/conf" includes="*"/>
      </copy>
 		<copy todir="${janusgraph_dir}/conf/gremlin-server" overwrite="true">
			<fileset dir="../src/sys/janusgraph/conf/gremlin-server" includes="*"/>
      </copy>                                                                
    <copy file="../src/sys/janusgraph/elasticsearch/config/elasticsearch-${site}.yml" tofile="${janusgraph_dir}/elasticsearch/config/elasticsearch.yml" overwrite="true"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@STORAGE.HOSTNAME@"               value="${zookeeper}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@STORAGE.JANUS.TABLE@"            value="${janus_table}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@STORAGE.HBASE.TABLE@"            value="${hbase_table}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@STORAGE.HBASE.SCHEMA@"           value="${hbase_schema}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@STORAGE.PORT@"                   value="${hbase_port}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@ROWKEY.NAME@"                    value="${rowkey_name}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@ROWKEY.NAME@"                    value="${rowkey_name}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@BACKEND.PHOENIX.URL@"            value="${phoenix_url}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@BACKEND.PHOENIX.PROXY.HOSTNAME@" value="${backend_phoenix_proxy_hostname}"/>
    <replace file="${janusgraph_dir}/scripts/setup-lomikel.groovy"               token="@BACKEND.PHOENIX.PROXY.PORT@"     value="${backend_phoenix_proxy_port}"/>
    <replace file="${janusgraph_dir}/conf/Local.yaml"                            token="@SERVER.HOST@"                    value="${gremlin_host}"/>
    <replace file="${janusgraph_dir}/conf/Local.yaml"                            token="@SERVER.PORT@"                    value="${gremlin_port}"/>
    <replace file="${janusgraph_dir}/conf/LocalCORS.yaml"                        token="@SERVER.HOST@"                    value="${gremlin_host}"/>
    <replace file="${janusgraph_dir}/conf/LocalCORS.yaml"                        token="@SERVER.PORT.CORS@"               value="${gremlin_port_cors}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.yaml"             token="@SERVER.HOST@"                    value="${gremlin_host}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.yaml"             token="@SERVER.PORT@"                    value="${gremlin_port}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/LocalCORS.yaml"         token="@SERVER.HOST@"                    value="${gremlin_host}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/LocalCORS.yaml"         token="@SERVER.PORT.CORS@"               value="${gremlin_port_cors}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@STORAGE.HOSTNAME@"               value="${zookeeper}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@STORAGE.PORT@"                   value="${hbase_port}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@STORAGE.HBASE.TABLE@"            value="${janus_table}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.HBASE.TABLE@"            value="${hbase_table}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.HBASE.SCHEMA@"           value="${hbase_schema}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.HBASE.PORT@"             value="${hbase_port}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.ROWKEY.NAME@"            value="${rowkey_name}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.PHOENIX.URL@"            value="${phoenix_url}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.PHOENIX.PROXY.HOSTNAME@" value="${backend_phoenix_proxy_hostname}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@BACKEND.PHOENIX.PROXY.PORT@"     value="${backend_phoenix_proxy_port}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@EVENTS.TABLE@"                   value="${events_table}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@EVENTS.SCHEMA@"                  value="${events_schema}"/>
    <replace file="${janusgraph_dir}/conf/gremlin-server/Local.properties"       token="@ELASTICSEARCH.HOSTNAME@"         value="${elasticsearch_hostname}"/>
    <copy file="${janusgraph_dir}/conf/gremlin-server/Local.properties"          tofile="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties" overwrite="true"/>
    <echo file="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties" append="true">storage.batch-loading=true</echo>
    <echo>... plugin</echo>
    <mkdir dir="${janusgraph_dir}/ext/lomikel.connector"/>
    <copy file="../lib/Lomikel-${version}.jar" tofile="${janusgraph_dir}/ext/Lomikel.connector/plugin/Lomikel.jar" overwrite="true"/>
    <exec executable="../src/sh/updateJanusExt.sh">
      <arg line="${janusgraph_dir}/ext/plugins.txt"/>
      </exec>
    <echo>Restart JanusGraph !</echo>
    </target>
  
  <!-- Start/Stop JanusGraph ================================================-->
  
  <target name="janus-start"
          description="Start JanusGraph Server">
    <echo>Starting JanusGraph Server</echo>
    <exec executable="${janusgraph_dir}/bin/janusgraph-server.sh">
      <env key="PID_FILE"        value="${janusgraph_dir}/run/janusgraph.pid"/>
      <env key="LOG_DIR"         value="${janusgraph_dir}/logs"/>
      <env key="JANUSGRAPH_YAML" value="${janusgraph_dir}/conf/gremlin-server/Local.yaml"/>
      <env key="HBASE_CONF_DIR"  value="${phoenix_conf_dir}"/>
      <env key="CLASSPATH"       value="${classpath_phoenix.run.content}"/>
      <arg line="start"/>
      </exec>
      </target>
  <target name="janus-start-cors"
          description="Start JanusGraph Server (CORS)">
    <echo>Starting JanusGraph Server (CORS)</echo>
    <exec executable="${janusgraph_dir}/bin/janusgraph-server.sh">
      <env key="PID_FILE"        value="${janusgraph_dir}/run/janusgraphCORS.pid"/>
      <env key="LOG_DIR"         value="${janusgraph_dir}/logsCORS"/>
      <env key="JANUSGRAPH_YAML" value="${janusgraph_dir}/conf/gremlin-server/LocalCORS.yaml"/>
      <env key="HBASE_CONF_DIR"  value="${phoenix_conf_dir}"/>
      <env key="CLASSPATH"       value="${classpath_phoenix.run.content}"/>
      <arg line="start"/>
      </exec>
    </target>
  
   <target name="janus-stop"
          description="Stop JanusGraph Server">
    <echo>Stopping JanusGraph Server</echo>
    <exec executable="${janusgraph_dir}/bin/janusgraph-server.sh">
      <env key="PID_FILE"        value="${janusgraph_dir}/run/janusgraph.pid"/>
      <env key="JANUSGRAPH_YAML" value="${janusgraph_dir}/conf/gremlin-server/Local.yaml"/>
      <arg line="stop"/>
      </exec>
    <echo>Stopping JanusGraph Server (CORS)</echo>
    <exec executable="${janusgraph_dir}/bin/janusgraph-server.sh">
      <env key="PID_FILE"            value="${janusgraph_dir}/run/janusgraphCORS.pid"/>
      <env key="JANUSGRAPH_YAML"     value="${janusgraph_dir}/conf/gremlin-server/LocalCORS.yaml"/>
      <arg line="stop"/>
      </exec>
    </target>
    
   <target name="es-start"
          description="Start Elastic Search">
    <echo>Starting Elastic Search</echo>
    <exec executable="${janusgraph_dir}/elasticsearch/bin/elasticsearch">
      <arg line="-d -v"/>
      </exec>
    </target>
    
   <target name="es-stop"
          description="Stop Elastic Search">
    <echo>Stopping Elastic Search</echo>
    <exec executable="../src/sh/stopES.sh"/>
    </target>
    
    <target name="es-clean"
          description="Clean Elastic Search">
    <echo>Stopping Elastic Search</echo>
    <exec executable="../src/sh/cleanES.sh"/>
    </target>
   
  <!-- Init JanusGraph ======================================================-->
  
   <target name="janus-init"
          description="Initialize JanusGraph">
    <echo>Initializing JanusGraph Database</echo>
    <exec executable="../src/sh/initJanus.sh"/>
    </target>
    
  <!-- Extract Schema =======================================================-->

  <target name="extract-schema"
          description="Extract Gremlin Schema">
    <echo>Extracting Gremlin Schema</echo>
    <java classname="com.Lomikel.Januser.JanusClient"
          fork="true">
      <arg value="extract"/>
      <arg value="${zookeeper}"/>
      <arg value="${hbase_table}"/>
      <classpath>
        <path refid="classpath.janusgraph"/>
        </classpath>
      </java>
    </target>
    
  <!-- Populate =============================================================-->

  <target name="check-utilities"
          description="Check Alert Utilities">
    <echo>Check Alert Utilities</echo>
    <java classname="com.astrolabsoftware.FinkBrowser.Januser.AlertUtilities"
          fork="true">
      <arg value="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties"/>
      <arg value="2459314.7213079"/>
      <arg value="2459314.722002344"/>
      <arg value="candidate"/>
      <arg value="2"/>
      <classpath>
        <path refid="classpath.janusgraph"/>
        </classpath>
      </java>
    </target>

  <target name="import-avro"
          description="Import Avro alerts to Graph">
    <echo>Import Avro alerts to Graph</echo>
    <java classname="com.astrolabsoftware.FinkBrowser.Avro.AvroImporter"
          fork="true">
      <arg value="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties"/>
      <arg value="${alerts_avrodir}"/>
      <arg value="${alerts_fitsdir}"/>
      <arg value="${alerts_reportLimit}"/>
      <arg value="${alerts_commitLimit}"/>
      <arg value="${alerts_strategy}"/>
      <classpath>
        <path refid="classpath.janusgraph"/>
        </classpath>
      </java>
    </target>
    
  <target name="import-avro-hdfs"
          depends="classpath.hadoop"
          description="Import Avro alerts from HDFS to Graph">
    <echo>Import Avro alerts from HDFS to Graph</echo>
    <exec executable="${hadoop_dir}/bin/hadoop">
      <arg value="com.astrolabsoftware.FinkBrowser.Avro.HDFSAvroImporter"/>
      <arg value="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties"/>
      <arg value="${alerts_avrodir}"/>
      <arg value="${alerts_fitsdir}"/>
      <arg value="${alerts_reportLimit}"/>
      <arg value="${alerts_commitLimit}"/>
      <arg value="${alerts_strategy}"/>
      <arg value="${alerts_hbase}"/>
      <arg value="${alerts_datatype}"/>
      <env key="HADOOP_CLASSPATH" path="${classpath.janusgraph.content}"/>
      </exec>
    </target>

  <target name="import-parquet"
          depends="classpath.hadoop"
          description="Import Parquet alerts to Graph">
    <echo>Import Parquet alerts to Graph</echo>
    <exec executable="${hadoop_dir}/bin/hadoop">
      <arg value="com.Lomikel.Parquet.ParquetReader"/>
      <arg value="${janusgraph_dir}/conf/gremlin-server/Local-batch.properties"/>
      <arg value="${alerts_parquetdir}"/>
      <arg value="${alerts_reportLimit}"/>
      <arg value="${alerts_commitLimit}"/>
      <arg value="${alerts_strategy}"/>
      <arg value="${alerts_hbase}"/>
      <env key="HADOOP_CLASSPATH" path="${classpath.janusgraph.content}"/>
      </exec>
    </target>
            
  <!-- Clean ================================================================-->

  <target name="clean"
          depends="init"
          description="Clean up">
    <delete includeEmptyDirs="true">
      <fileset dir="../build" includes="**/*"/>
      </delete>
    <delete includeEmptyDirs="true">
      <fileset dir="../lib" includes="**/*"/>
      </delete>
    <delete includeEmptyDirs="true">
      <fileset dir="../doc" includes="**/*"/>
      </delete>
    <delete includeEmptyDirs="true">
      <fileset dir="../dist" includes="**/*"/>
      </delete>
    <!--delete includeEmptyDirs="true">
      <fileset dir="../extlib/import" includes="**/*"/>
      </delete-->
    <delete includeEmptyDirs="true">
      <fileset dir="." includes="**/*"/>
      </delete>
   </target>
   
  <!-- Dist =================================================================-->

  <target name="dist"
          depends="jar"
          description="Construct distribution">
    <mkdir dir="../dist"/>
    <copy todir="../dist">
			<fileset dir="../lib" includes="*.jar"/>
			<fileset dir="../extlib/import" includes="*.jar"/>
			<file file="${phoenix_jar}"/>
      </copy>
    <exec executable="../src/sh/packExtJars.sh"/>
  </target>

  <!-- Check ================================================================-->
    
  <target name="check-sockets"
          description="Check Sockets">
    <echo>Check Sockets</echo>
    <java classname="net.hep.atlas.Database.Atlascope.Sockets.SocketTest"
          fork="true">
      <classpath>
        <path refid="classpath.run"/>
        </classpath>
      </java>
    </target>
    
  <target name="check-phoenix"
          description="Check Phoenix using Groovy">
    <echo>Check Phoenix using Groovy</echo>
    <groovy>
      <fileset file="../src/groovy/testPhoenix.groovy"/>
      <classpath>
        <path refid="classpath_phoenix.run"/>
        <pathelement location="${groovy_sql_jar}"/>
        </classpath>
      </groovy>
    </target>
  
  <!-- JavaDoc ==============================================================-->

  <target name="doc"
          depends="jar,j2h,viz"
          description="Construct documentation">
    <mkdir dir="../doc"/>
 		<copy todir="../doc">
			<fileset dir="../src" includes="*.html"/>
			<fileset dir="../src" includes="*.jpeg"/>
 			<fileset dir="../src" includes="*.jpg"/>
     </copy>
    <mkdir dir="../doc/JavaDoc"/>
 		<copy todir="../doc/JavaDoc">
			<fileset dir="../src/java" includes="**/doc-files/*"/>
      </copy>
    <mkdir dir="../doc/Gremlin"/>
 		<copy todir="../doc/Gremlin">
			<fileset dir="../src/gremlin" includes="*.gremlin"/>
			<fileset dir="../src/gremlin" includes="examples.gremlin"/>
			<fileset dir="../src/gremlin" includes="examplesLomikel.gremlin"/>
      </copy>
    <mkdir dir="../doc/BeanShell"/>
 		<copy todir="../doc/BeanShell">
			<fileset dir="../src/bsh" includes="*.bsh"/>
      </copy>
    <mkdir dir="../doc/Python"/>
 		<copy todir="../doc/Python">
			<fileset dir="../src/python" includes="*.py"/>
			<fileset dir="../src/python" includes="*.jy"/>
			<fileset dir="../src/python" includes="*.sage"/>
      </copy>
    <mkdir dir="../doc/Jupyter"/>
 		<copy todir="../doc/Jupyter">
			<fileset dir="../src/Jupyter" includes="*.nb"/>
			<globmapper from="*.nb" to="*.nb-txt"/>
      </copy>
    <javadoc packagenames="*"
             doclet="org.jboss.apiviz.APIviz"
             docletpath="../extlib/apiviz-1.3.4.jar:../extlib/jdepend-2.9.5.jar:../extlib/tools-1.8.0.jar"
             sourcepath="../src/java:../build"
             destdir="../doc/JavaDoc"
             author="true"
             version="true"
             use="true"
             private="true"
             additionalparam=" -linksource -breakiterator -keywords -author -version"
             source="1.8"
             Overview="../src/java/com/Lomikel/overview.html"
             windowtitle="Lomikel">
      <doctitle><![CDATA[<u>]]>Lomikel<![CDATA[</u>]]></doctitle>
      <Header><![CDATA[<center>]]>Lomikel version: ${version}<![CDATA[</center>]]></Header>
      <Footer><![CDATA[<center>Written by: <a href='http://cern.ch/hrivnac'>J.Hrivnac</a></center>]]></Footer>
      <bottom><![CDATA[<a href='https://cern.ch/hrivnac/Activities/Packages/Lomikel'>Documentation</a>]]> built ${TODAY} on ${os.name} by ${user.name}</bottom>
      <group title="Apps"            packages="com.Lomikel.Apps*"/>
      <group title="DB"              packages="com.Lomikel.DB*"/>
      <group title="Parquet"         packages="com.Lomikel.Parquet*"/>
      <group title="Hadooper"        packages="com.Lomikel.Hadooper*"/>
      <group title="HBaser"          packages="com.Lomikel.HBaser*"/>
      <group title="Januser"         packages="com.Lomikel.Januser*"/>
      <group title="ElasticSearcher" packages="com.Lomikel.ElasticSearcher*"/>
      <group title="Phoenixer"       packages="com.Lomikel.Phoenixer*"/>
      <group title="Graph"           packages="com.Lomikel.Graph*"/>
      <group title="Utils"           packages="com.Lomikel.Utils*"/>
      <group title="Sockets"         packages="com.Lomikel.Sockets*"/>
      <group title="GremlinPlugin"   packages="com.Lomikel.GremlinPlugin*"/>
      <group title="GUI"             packages="com.Lomikel.GUI*"/>
      <group title="TinkerPopPatch"  packages="com.Lomikel.TinerPopPatch*"/>
      <group title="WebService"      packages="com.Lomikel.WebService*"/>
      <group title="Fink Avro"       packages="com.astrolabsoftware.FinkBrowsrr.Avro*"/>
      <group title="Fink Parquet"    packages="com.astrolabsoftware.FinkBrowsrr.Parquet*"/>
      <group title="Fink HBaser"     packages="com.astrolabsoftware.FinkBrowser.HBaser*"/>
      <group title="Fink Januser"    packages="com.astrolabsoftware.FinkBrowser.Januser*"/>
      <group title="Fink WebService" packages="com.astrolabsoftware.FinkBrowser.WebService*"/>
      <group title="LehmanUtils"     packages="de.lehmannet.om.util*"/>
      <link href="http://docs.oracle.com/javase/8/docs/api" packagelistLoc="${javadoc}" offline="true"/>
      <link href="http://www.beanshell.org/javadoc/"/>
      <link href="https://logging.apache.org/log4j/1.2/apidocs"/>
      <link href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs"/>
      <link href="http://stleary.github.io/JSON-java"/>
      <link href="https://commons.apache.org/proper/commons-cli/apidocs"/>
      <link href="https://javadoc.io/doc/org.janusgraph/janusgraph-core/latest"/>
      <link href="https://tinkerpop.apache.org/javadocs/current/full"/>
      <link href="http://www.beanshell.org/javadoc"/>
      <link href="https://commons.apache.org/proper/commons-cli/apidocs"/>
      <link href="https://cds-astro.github.io/cds-healpix-java/apidocs"/>
      <link href="https://avro.apache.org/docs/1.8.2/api/java"/>
      <link href="https://javadoc.io/doc/org.python/jython-standalone/latest"/>
      <classpath>
        <path refid="classpath.run"/>
        </classpath>
      </javadoc>
    <replace file="../doc/index.html" token="@VERSION@" value="${version}"/>
    <replace file="../doc/index.html" token="@BUILD@"   value="${TSTAMP} by ${user.name}"/>
  </target>

  <!-- Post =================================================================-->

  <target name="post"
          depends="jar,doc,war,dist"
          description="Post documentation and distribution">
    <delete includeEmptyDirs="true">
      <fileset dir="${doc}" includes="**/*"/>
      </delete>
 		<copy todir="${doc}" force="true">
			<fileset dir="../doc" includes="**/*"/>
			<fileset dir="../lib" includes="Lomikel.exe.jar"/>
      </copy>
    </target>

  <!-- JDepend ==============================================================-->

  <target name="jdepend"
          depends="init"
          description="Analyse dependencies">
    <java classname="jdepend.swingui.JDepend"
          fork="true"
          failonerror="true">
      <arg value="../build"/>
      <classpath>
          <pathelement location="../extlib/jdepend-2.9.5.jar"/>
          </classpath>
      </java>
    </target>

  <!-- j2h ==================================================================-->

  <target name="j2h"
          depends="init"
          description="Construct source documentation">
    <taskdef name="java2html" classname="com.java2html.Java2HTMLTask">
      <classpath>
        <pathelement location="../extlib/j2h.jar"/>
        </classpath>
      </taskdef>
	  <java2html title="Lomikel" 
               simple="no"
             	  tabsize="4"
		            marginsize="2"
		            header="true"
		            footer="true"
		            destination="../doc/Src">
		  <fileset dir="../src"   includes="**/*.java"/>
		  <fileset dir="../build" includes="**/*.java"/>
		  <javadoc localRef="${javadoc}" httpRef="http://docs.oracle.com/javase/8/docs/api"/>
	    </java2html>
    </target>

  <!-- Viz ==================================================================-->

  <target name="viz"
          depends="init"
          description="Create flow of build file">
    <taskdef name="vizant" classname="net.sourceforge.vizant.Vizant"> 
      <classpath>
        <pathelement location="../extlib/vizant.jar"/>
        </classpath>
      </taskdef>
    <vizant antfile="../ant/build.xml" outfile="../doc/build.dot"/>
    </target>
    
  <!-- Find Bugs ============================================================-->  

  <target name="findbugs"
          depends="jar"
          description="FindBugs Check">
    <property name="findbugs.home"
              value="${findbugs}"/>
    <taskdef name="findbugs"
             classpath="${findbugs.home}/lib/findbugs-ant.jar"
             classname="edu.umd.cs.findbugs.anttask.FindBugsTask"/>
    <findbugs home="${findbugs.home}"
              output="text"
              outputFile="../run/FindBugs.out"
              excludeFilter="../ant/FindBugs-ExcludeFilter.xml">
      <auxClasspath>
        <path refid="classpath.run"/>
        </auxClasspath>
      <sourcePath path="../src" />
      <class location="../lib/Lomikel-${version}.jar" />
      </findbugs>   
    </target>
    
  <target name="spotbugs"
          depends="jar"
          description="SpotBugs Check">
    <spotbugs home="${spotbugs}"
              output="html"
              outputFile="Spotbugs.html" >
      <auxClasspath refid="classpath.build"/>
      <sourcePath path="../src/java" />
      <class location="../lib/Lomikel-${version}.jar" />
      </spotbugs>
    </target>

  <!-- Clean Imports ========================================================-->  

  <target name="cleanimports"
          description="Clean Unused Imports">
    <exec executable="../src/python/remove-unused-imports.py">
      <arg line="../src/java/com/Lomikel"/>
      </exec>
    </target>
 
  <!-- ======================================================================-->

  </project>
